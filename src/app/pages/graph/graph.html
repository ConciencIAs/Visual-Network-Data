<div id="wrap" class="relative w-screen h-screen">
  <div id="graph" #graph></div>
  <div class="absolute top-2 left-2 z-10 space-x-2 p-2 flex flex-wrap">
    @for (field of clusterFields; track field.key) {
    <button
      (click)="clusterBy(field.key)"
      class="m-1 px-2 py-2.5 rounded-md cursor-pointer text-white-900 text-sm tracking-wider font-medium border border-gray-400 outline-0 bg-transparent hover:bg-gray-50"
    >
      Agrupar por {{ field.label }}
    </button>
    }
  </div>
  <aside
    class="absolute bottom-4 left-4 z-10 bg-black/40 backdrop-blur-xl rounded-2xl p-6 border border-white/20 shadow-2xl max-w-md transition-all duration-300"
    [class.opacity-0]="!isSelectedNode"
  >
    @if (isSelectedNode) {
    <div class="space-y-4">
      <div class="flex items-start justify-between">
        <div>
          <h2 class="text-2xl font-bold text-white mb-1">{{ selectedNode()?.full_name }}</h2>
          <div class="flex gap-2">
            <span
              class="px-2 py-1 rounded-lg bg-indigo-500/30 text-indigo-200 text-xs font-semibold border border-indigo-400/30"
            >
              {{ selectedNode()?.age }} a√±os
            </span>
            <span
              class="px-2 py-1 rounded-lg bg-purple-500/30 text-purple-200 text-xs font-semibold border border-purple-400/30"
            >
              {{ selectedNode()?.gender }}
            </span>
          </div>
        </div>
        <button
          (click)="closeDetails()"
          class="p-1 pointer rounded-lg hover:bg-white/10 text-white/60 hover:text-white transition-colors"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>

      @if (selectedNode()?.message) {
      <div class="bg-white/5 rounded-xl p-4 border border-white/10">
        <h3 class="text-white/60 text-xs font-semibold mb-2 uppercase tracking-wider">Mensaje</h3>
        <p class="text-white text-sm leading-relaxed">{{ selectedNode()?.message }}</p>
      </div>
      }
    </div>
    } @else {
    <div class="text-center text-white/60 py-8">
      <svg
        class="w-12 h-12 mx-auto mb-3 opacity-50"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"
        />
      </svg>
      <p class="text-sm">Haz clic en un nodo para ver sus detalles</p>
    </div>
    }
  </aside>
</div>
